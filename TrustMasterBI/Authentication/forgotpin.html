<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title></title>
	</head>
	<body>
		<div data-role="view" data-title="Forgot Pin" data-layout="BackHeader" data-before-show="cleanview">
			<div class="textboxStyle">
               <div class="logo">
					<img src="../images/logo.png" alt="" />
				</div>
				<table id="forgotPinForm" class="form">
					<tr>
						<td>
							<label for="txtemailId" class="lblStyle">Email :</label>
						</td>
						<td>
							<input type="text" id="txtemailId" value="" />
						</td>
					</tr>
					<tr>
						<td>
						</td>
						<td class="button">
							<a id="btnSubmit" data-role="button">Submit</a>
							<a id="resetButton" data-role="button">Reset</a>
						</td>
					</tr>
				</table>
				<div id="Response">
					Please check your mail.
					We've sent your password to your email address.
				</div>
			</div>
			<script>
				$("#btnSubmit").click(function () {
					try {
						$("#btnSubmit").attr("disabled", "disabled");
						$.ajax({
							"url": "http://localhost:29100/User/ForgotPin",
							"method": "post",
							"dataType": "json",
							"data": "uidDevice=" + window.top.device.uuid + "&email=" + $("#txtemailId").val()
						})
						.done(function(data, textStatus, jqXHR) {
							try {
								data = eval(data)[0];
								if (data.resultCode == window.top.Onit1.ResultCode.Success) { // login successful
									$("#forgotPinForm").hide();
									$("#Response").show();
								}
								else 
									alert(data.message);
							}
							catch (e) {
								alert("Server sent incorrect data. Please contact On-IT1.");
							}
						})
						.fail(function(jqXHR, textStatus, errorThrown) {
							alert("Server error. Please contact On-IT1.\n\n" + errorThrown);
						})
						.always(function () {
							$("#btnSubmit").removeAttr("disabled");
						});
					}
					catch (e) {
						alert("Error occurred. Please contact On-IT1.\n\n" + e);
					}
				});
				$(document).ready(function() {
					$("#forgotPinForm").show();
					$("#Response").hide();
				});                
			</script>
		</div>
	</body>
</html>
