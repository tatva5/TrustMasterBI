<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title></title>
	</head>
	<body>
		<div class="loginbg" data-role="view" data-title="Login" data-layout="customwidHeader" style="position: relative;" data-before-show="cleanview">
			<div class="logo">
				<img src="../images/logo.png" alt="" />
			</div>
			<div class="login" id="mylogin">
				<table border="0"  cellpadding="0" class="noicon">
					<tr>
						<td class="pinWidth" align="right">Pin :</td>
						<td>
							<input name="pin" id="pin" type="text" required validationMessage="*"  value="1234"/>
						</td>
					</tr>
					<tr>
						<td>&nbsp;</td>
						<td>
							<div class="btn">
								<a data-role="button" id="loginbtn" class="inputbtn">Login</a>
							</div>
							<div class="fg_link">
								<a data-role="button"  href="../Authentication/forgotpin.html" style="border:none;background:none;padding:0px;margin:0px;">Forgot Pin?</a>
							</div>
						</td>
					</tr>
				</table>
			</div>
			<script>
				var validator = $("#mylogin").kendoValidator().data("kendoValidator");
				
				// TrustMaster Mobile global variables
				if (typeof window.top.Onit1 == "undefined") {
					window.top.Onit1 = {};
				}
				
				if (typeof window.top.Onit1.ResultCode == "undefined") {
					window.top.Onit1.ResultCode = {
						"Success": 0,
						"Error": 1
					};
				}
				
				if (typeof window.top.Onit1.Paths == "undefined") {
					window.top.Onit1.Paths = {
						"Index": ""
					};
				}
				
				$("#loginbtn").on("click", function(e) {
					if (validator.validate()) {
						try {
							$("#loginbtn").attr("disabled", "disabled");
							$.ajax({
								"url": "http://onit1.homenet.org/TrustMasterMobileWebService/User/Login",
								"method": "post",
								"dataType": "json",
								"data": "deviceUuid=" + window.top.device.uuid + "&pin=" + $("#pin").val()
							})
							.done(function(data, textStatus, jqXHR) {								
								try {
									$("#loginbtn").removeAttr("disabled");
									data = eval(data)[0];
									if (data.resultCode == window.top.Onit1.ResultCode.Success) { // login successful
										alert("Login successful. Please proceed to Services tab.");
										app.navigate("../Common/services.html");
									}
									else {
										alert("Login failed:\n\n" + data.message);
									}
								}
								catch (e) {
									alert("Server sent incorrect data. Please contact On-IT1.");
								}
							})
							.fail(function(jqXHR, textStatus, errorThrown) {
								alert("Server error. Please contact On-IT1.\n\n" + errorThrown);
							})
							.always(function () {
								$("#btnLogOn").removeAttr("disabled");
							});
						}
						catch (e) {
							alert("Error occurred. Please contact On-IT1.\n\n" + e);
						}
					}
				});				             
			</script>
		</div>

	</body>
</html>
